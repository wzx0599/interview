## 进程和线程

+ 进程，线程和协程之间的区别是什么？

  + 进程是系统资源分配的最小单位，操作系统会以进程为单位，分配系统资源
  + 线程是系统调度执行的最小单位
  + 协程是一种用户态的轻量级线程，协程的调度完全由用户控制

  👉一个进程就是一个正在执行程序的实例，包含代码段、堆栈段和数据段，有自己独立的地址空间

  👉线程是系统调度执行的最小单位，同一个进程的线程共享同一个地址空间，每个线程有自己的程序计数器和保存当前工作变量的寄存器。

  | 每个进程中的内容                                             | 每个线程中的内容                           |
  | ------------------------------------------------------------ | ------------------------------------------ |
  | 地址空间<br />全局变量<br />打开的文件<br />子进程<br />即将发生的定时器<br />信号与信号处理程序<br />账户信息 | 程序计数器<br />寄存器<br />堆栈<br />状态 |

+ 进程的有几种运行状态？运行态可以变成就绪态吗？

  + 运行态：进程占用CPU，并在CPU上运行

  + 就绪态：进程已经具备运行条件，但是还没有分配CPU资源

  + 阻塞态：进程因等待某件事发生而暂时不能运行

    当CPU分配给该进程的时间片用完，就会挂起该进程，该进程由运行态变为就绪态等待执行

+ 进程切换的时机是什么？

  分配给进程的CPU时间片用完了或者进程因为等待某个资源的就绪而进入阻塞

+ 操作系统如何处理中断？

  ![image-20210711204218318](E:\钟明\钟明\学习\githubBlog\interview\操作系统img\image-20210711204218318.png)

+ 临界区、互斥、忙等待、进程间通信原语

  对共享内存进行访问的程序片段为临界区，两个进程不能同时处于临界区

  - 实现互斥的方法：屏蔽中断、锁变量、严格轮换法、Peterson解法（锁变量与警告变量结合）、TSL指令（硬件指令——测试并加锁）

  - 连续测试一个变量直到某个值出现为止称为**忙等待**，用于忙等待的锁称为**自旋锁**

  - 进程间通信原语：在进程无法进入临界区时阻塞而不是忙等待

    - sleep wakeup信号，当信号丢失时会发生永远睡眠的情况（两个进程时可采用唤醒等待位解决，不适用于多个进程）

    - 信号量：一个信号量可以取0（表示没有保存下来的唤醒操作）或取正值（表示有一个或多个唤醒操作）

      ✔信号量的操作：up 和 down 

      down：信号量>0则执行并减一，=0则阻塞（整个过程为原子操作）

      up：信号量+1，进程选择一个在该信号量上阻塞的进程执行down操作

      ✔信号量的作用：二元信号量——互斥，同步（生产者消费者问题，缓冲区满生产者停止、缓冲区空消费者停止）

    - 互斥量：忙等待和互斥的区别（若是用户级线程 没有时钟调度，会一直等待下去，而互斥在无法获得锁时阻塞，自动释放CPU）
    - pthread的条件变量——用于在线程没有达到某个条件时阻塞，实现线程同步。互斥和条件变量经常一起使用，用于让一个线程锁住一个互斥量，然后当它不能获得期待的结果时等待一个条件变量，最后另一个线程会给它发信号使它继续执行。条件变量（不像信号量）不会存在内存中，即信号可能会丢失。
    - 管程：一个管程是由过程、变量、数据结构等组成的集合，组成一个特殊的模块或软件包，任意时刻管程中只能有一个活跃进程，进入管程时的互斥由编译器负责。

+ 函数调用时栈会发生什么变化？

  

+ 单核计算密集型任务，单线程好还是多线程好？

  由于单个任务已经可以将CPU资源100%消耗了，所以没有必要使用多线程来提高CPU资源的利用率，但是对于存在人机交互的情况，最好还是使用多线程，否则用户无法对计算机进行操作。

## 内存管理

1.**地址空间**是一个进程可用于寻址内存的一套地址集合

:star:空闲区管理：位图和空闲区链表​

2.**虚拟内存**：解决程序实际所需内存大于物理内存问题，程序的地址空间划分为页面，物理内存划分为页框，通过页表映射，页表存于内存中（分页技术），每个进程有自己的页表，当没有页框与页面匹配时发生缺页中断

:star:加速分页：转换检测缓冲区（TLB-快表），在MMU中，包含访问频次高的页表项，没找到时发生TLB失效。TLB作用时加快虚拟地址到物理地址的转换

:star:针对大内存的页表：

- 多级页表
- 倒排页表：页表改为由物理地址到虚拟地址的映射（不足是加大了由虚拟地址转为物理地址的难度——搜索整个页表，改进是用TLB以及用虚拟地址散列的方法查找）

3.**页面置换算法**：

:star:最优页面置换算法：将最晚需要的页面置换出去（理想上，不能实现，用于评价页面置换算法）​

:star:最近未使用页面置换算法：R位（访问位）和W位（修改位），R位被定期的清零，在最近一个时钟滴答中淘汰一个没有被访问的已修改页面比淘汰一个频繁被使用的“干净”页面要好

:star:先进先出页面置换算法FIFO

:star:第二次机会页面置换算法：​改进的FIFO算法，检查在链表头的R位，如果为0则淘汰，如果为1就将R位置零并将其放到链表尾，（淘汰在最近的时钟间隔内没有访问的页面）

:star:时钟页面置换算法​

改进的第二次机会算法，第二次机会要经常改动页面的位置，该方法将链表改为环形链表，有一个指针指向最旧的页面

:star:最近最少使用页面置换算法（LRU）：硬件计数器（或者维持链表，最近最多使用在前，最近最少使用在后）或***软件老化算法***（每次时钟滴答将计数器右移一位然后将R位加到最左端）​

:star:工作集页面置换算法：一个进程当前正在使用的页面的集合称为工作集，在任意时刻，都存在一个集合包含所有最近k次内存访问所访问过的页面，该集合就是工作集。预先调页。找出一个不在工作集的页面并淘汰它。相当于既用了R位，M位，又记录了一个上次访问时间。

:star:***工作集时钟页面置换算法***：基于时钟算法的工作集页面置换

4.**内存动态分配**：局部置换、全局置换，缺页中断率（PFF）

5.**分段**：不同的数据类型划分独立的地址空间（二维段号和段内地址），优点：简化对长度经常变化的数据结构的管理、简化把单独编译好的过程链接起来的操作、过程和数据可以被区分并单独保护、有助于进程间共享过程和数据

## 文件系统

- **文件的实现**：
  - 连续分配——实现简单（开始磁盘块+块数）、读性能好（单个操作能从磁盘上读出整个文件）；空间浪费、必须指定文件大小（用于CD-ROM）
  - 链表分配——为每个文件构造磁盘块链表，随机访问慢、每个磁盘块存储的字节数不再是2的整数次幂
  - 采用内存中的表进行链表分配——文件分配表（FAT），占用内存、不适用于大型磁盘
  - i节点——每个文件赋予一个数据结构，只有在文件打开时其i节点才会读入内存

- **目录的实现**

  目录系统的主要功能是将ASCII文件名映射成定位文件数据所需要的信息。目录项存放文件名和i节点号

- **提高文件系统性能**：高速缓存、预读块、减少磁盘臂运动

- **文件描述符**

  操作系统为每个进程维护一个打开文件表

  文件描述符是这个表中的索引



## 死锁

+ 死锁的定义及产生条件

  死锁是指两个或两个以上进程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。

  - 资源死锁的条件——互斥条件、占有和等待条件、不可抢占条件、环路条件
  - 死锁检测和死锁恢复、死锁预防、通信死锁、活锁
  - 死锁预防：打破四个条件之一
    - 破坏互斥条件：可共享资源，易发生冲突
    - 破坏占有并等待：每个进程要么获得全部资源要么无法获得资源，容易出现饥饿现象，资源利用率低
    - 破坏不可抢占条件：易引起混乱
    - 破坏环路等待条件：为资源编号，每个进程只能按照资源编号的顺序申请资源
  - 死锁避免：动态检测资源的分配状态
    - 当一个进程请求可用资源，系统必须判断分配资源是否能使系统处于安全状态
  - 死锁检测和死锁恢复
    - 死锁检测：每种类型一个资源的死锁检测（检测资源分配图的环）、每种类型多个资源的资源检测
    - 死锁恢复：利用抢占恢复、利用回滚恢复、通过杀死进程恢复

## 输入输出

1. **RAID**独立磁盘冗余阵列
2. **磁盘格式化**——（1）低级格式化（使磁盘容量变小减小的量取决于前导码、扇区间隙和ECC大小以及保留的备用扇区数目），每个磁道上第0扇区的位置与前一磁道存在偏移（柱面斜进）（2）分区（大多数计算机0分区包含主引导记录MBR）（3）高级格式化（设置引导块、空闲存储管理、根目录、空文件系统）
3. 磁盘臂调度算法——读写磁盘块时间包括：寻道时间、旋转延迟、实际数据传输时间，磁盘寻道时间占主导。（1）先来先服务（2）最短寻道优先（3）电梯算法
